<project name="project-include">

  <!-- figure out the absolute path to this build file -->
  <dirname property="etc.dir" file="${ant.file.project-include}"/>
  <import file="${etc.dir}/flex-include.xml"/>

  <!-- overridable properties -->
  <property name="flex.use-network" value="false"/>
  <property name="app.source-suffix" value="as"/>
  <property name="app.source-dir" value="."/>
  <property name="app.package-dir" value="."/>

  <!-- determines whether the top-level aslib has been built -->
  <target name="checktop">
    <condition property="aslib.built">
      <available file="${build.root}/dist/whirled.swc"/>
    </condition>
  </target>

  <!-- builds the top-level aslib if necessary -->
  <target name="buildtop" depends="checktop" unless="aslib.built">
    <echo>Building the Whirled shared Flash library...</echo>
    <ant dir="${build.root}" target="aslib"/>
  </target>

  <!-- builds our SWF file -->
  <target name="compile" depends="prepare-flex,buildtop">
    <java jar="${flex.path}/lib/mxmlc.jar" fork="true" failonerror="true">
      <arg value="-load-config"/>
      <arg value="${etc.dir}/whirled-config.xml"/>
      <arg value="-use-network=${flex.use-network}"/>
      <arg value="-compiler.source-path=${app.source-dir}"/>
      <arg value="-file-specs"/>
      <arg value="${app.source-dir}/${app.package-dir}/${app.name}.${app.source-suffix}"/>
      <arg value="-output"/>
      <arg value="${app.name}.swf"/>
    </java>
  </target>

  <!-- builds our SWF file in debug mode -->
  <target name="debug" depends="prepare-flex,buildtop">
    <java jar="${flex.path}/lib/mxmlc.jar" fork="true" failonerror="true">
      <arg value="-load-config"/>
      <arg value="${etc.dir}/whirled-config.xml"/>
      <arg value="-use-network=${flex.use-network}"/>
      <arg value="-compiler.debug"/>
      <arg value="-compiler.verbose-stacktraces=true"/>
      <arg value="-compiler.source-path=${app.source-dir}"/>
      <arg value="-file-specs"/>
      <arg value="${app.source-dir}/${app.package-dir}/${app.name}.${app.source-suffix}"/>
      <arg value="-output"/>
      <arg value="${app.name}.swf"/>
    </java>
  </target>

  <!-- cleans out the compiled SWF -->
  <target name="clean">
    <delete>
       <fileset file="${app.name}.swf"/>
    </delete>
  </target>

</project>
